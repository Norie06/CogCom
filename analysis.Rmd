---
title: "Cogcom project"
output: pdf_document
date: "2024-12-09"
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}

knitr::opts_chunk$set(echo = TRUE)  

knitr::opts_knit$set(root.dir = '/work/CogSci_Methods01/cogcom-project/CogCom') 
rm(list=ls())
```

## Loading relevant libraries and data

```{r libraries, message = FALSE, warning = FALSE}
library(tidyverse)
library(afex)
library(lme4)
library(emmeans)

```
```{r loading_data}
# Loading the data

df <- read_csv("CogCom-data.csv")

head(df)

df <- df %>% mutate(Gaze = as.factor(Gaze))
df <- df %>% mutate(Audio = as.factor(Audio))
```
```{r plots}

df %>% ggplot(aes(Gaze,Score))+
      geom_bar(stat = 'summary',
             fun = "mean",
             width = 0.5,
             fill = "skyblue") +
      geom_errorbar(stat = 'summary',
                  fun.data = "mean_se",
                  width = 0.2) +
       labs(x = "Gaze direction", 
          y = "Mean credibility score (scale from 1-10)", 
          title = "Mean credibility score by gaze direction") +
    theme_minimal()

ggplot(df, aes(x = Gaze, y = Score)) +
    geom_boxplot(fill = "skyblue")+
    labs(title = "Boxplot of Credibility Scores Across Gaze and Audio Conditions",
         x = "Gaze direction",
         y = "Credibility score (scale from 1-10)")+
           theme_minimal()

df %>% 
  group_by(Gaze) %>% 
  summarize(mean_gaze = mean(Score, na.rm = TRUE))

```

```{r normality_data}

#Check linearity
    m0 <- lm(Score ~ Gaze + Audio, data = df)
    plot(m0)

#Check the normality of Score
    round(pastecs :: stat.desc(df$Score, basic = FALSE, norm = TRUE), digits = 2)
    hist(df$Score)
    qqnorm(df$Score)
    qqline(df$Score)

    shapiro.test(df$Score)

```



```{r lmer}

# Mixed-effects model
    model <- lmer(Score ~ Gaze + Audio + (1 + Gaze|Participant_ID), data = df)
    
    summary(model)



# Checking residuals

    plot(fitted(model), resid(model), main = "Residuals vs Fitted", xlab = "Fitted values", ylab = "Residuals")
    abline(h = 0, col = "red")
    
    hist(resid(model), main = "Histogram of Residuals", xlab = "Residuals", breaks = 20)
    
    qqnorm(resid(model))
    qqline(resid(model), col = "red")
    
    shapiro.test(resid(model))


# Checking normality of random effects

    random_effects <- ranef(model)$Participant_ID[, 1]
    
    hist(random_effects, main = "Histogram of Random Effects for Participant_ID", xlab = "Random Effects", breaks = 20)
    
    qqnorm(random_effects)
    qqline(random_effects, col = "red")
    
    shapiro.test(random_effects)



```




```{r post-hoc}

# Performing pairwise comparisons for Gaze and Audio
    emmeans_model <- emmeans(model, ~ Gaze + Audio)
    summary(emmeans_model)
    pairs(emmeans_model, adjust = "tukey")

# Creating a plot of pairwise comparisons
    ggplot(as.data.frame(emmeans_model), aes(x = Gaze, y = emmean, color = Audio, group = Audio)) +
        geom_point() +
        geom_line() +
        geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2) + 
        theme_minimal() +
        labs(title = "Effect of Gaze and Audio on Credibility",
             y = "Estimated Mean Credibility Score",
             x = "Gaze Condition")
    
    plot(emmeans_model) + coord_flip() + theme_minimal() +   
        labs(title = "Effect of Gaze and Audio on Credibility across all conditions",
             y = "Estimated Mean Credibility Score",
             x = "Gaze Condition")

```
